<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR" import="com.oreilly.servlet.MultipartRequest, 
 com.oreilly.servlet.multipart.DefaultFileRenamePolicy,java.util.*,java.io.*,bean.*"%>

<jsp:useBean id="books" class="bean.BookMember" />
<%
 request.setCharacterEncoding("euc-kr");
 String realFolder = "";
 int maxSize = 1024*1024*5;
 String encType = "euc-kr";
 String savefile = "file";
 ServletContext scontext = getServletContext();
 realFolder = scontext.getRealPath(savefile);
 MultipartRequest multi = null;
 multi = new MultipartRequest(request,realFolder,maxSize,encType,new DefaultFileRenamePolicy());
 try{
 
  
  String bookstri = multi.getParameter("bookstri");
  String title = multi.getParameter("title");
  String price = multi.getParameter("price");
  String quantity = multi.getParameter("quantity");
  String writer = multi.getParameter("writer");
  String pub = multi.getParameter("pub");
  String year = multi.getParameter("year");
  String m = multi.getParameter("m");
  String d = multi.getParameter("d");
  String pub_day = (year+"/"+m+"/"+d);
  Enumeration files = multi.getFileNames();
  String name1 = (String)files.nextElement();
  String name = multi.getFilesystemName(name1);
  Enumeration params = multi.getParameterNames();
  
  String discount = multi.getParameter("discount");
  String text = multi.getParameter("text");
  
  boolean flag = books.insertBoard(bookstri,title,price,quantity,writer,pub,pub_day,discount,text,name);
  
  if(flag){
  System.out.println("저장 되었습니다");
  }else{
  System.out.println("저장 되지 않았습니다");
  }
  

  while(params.hasMoreElements()){
   String name2 = (String)params.nextElement();
   String value1 = multi.getParameter(name2);
   multi.getParameter(name2);
 

 }
  
 while(files.hasMoreElements()){
  String name2 = (String)files.nextElement();
  String filename1 = multi.getFilesystemName(name2);
  String original1 = multi.getOriginalFileName(name2);
  String contentType = multi.getContentType(name2);
  File f = multi.getFile(name2);
  out.println("name:"+name1+"<br>");
  out.println("file:"+filename1+"<br>");
  out.println("orig:"+original1+"<br>");
  out.println("content:"+contentType+"<br>");
  out.println("ff"+f+"<br>");
 }
  
 }catch(Exception e){
  System.out.println("북 에러"+e);
 }
Vector v = books.book_chk();
int Result = v.size();
%>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
</head>
<body>
<center>
<table border="1" width="500">
 <tr>
  <td>번호</td><td>책종목</td><td>이미지</td>
 </tr>
<%
for(int q=0; q<Result; q++){
BookBean book = (BookBean)v.get(q);
%>
 <tr>
  <td><%=book.getNos() %></td>
  <td><%=book.getBookstri() %></td>
  <td><img src="file/<%=book.getBookimg() %>" width="50" height="50"></td>
 </tr>

<%}%>

</table>
</center>
</body>
</html>